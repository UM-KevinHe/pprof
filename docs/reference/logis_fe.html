<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Main function for fitting the fixed effect logistic model — logis_fe • pprof</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.9/font.css" rel="stylesheet"><link href="../deps/JetBrains_Mono-0.4.9/font.css" rel="stylesheet"><link href="../deps/Roboto_Slab-0.4.9/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Main function for fitting the fixed effect logistic model — logis_fe"><meta name="description" content="Fit a fixed effect logistic model via Serial blockwise inversion Newton (SerBIN) or block ascent Newton (BAN) algorithm."><meta property="og:description" content="Fit a fixed effect logistic model via Serial blockwise inversion Newton (SerBIN) or block ascent Newton (BAN) algorithm."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">pprof</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/pprof.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-appendix" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Appendix</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-appendix"><li><a class="dropdown-item" href="../articles/Risk-adjustment_Model.html">Risk-adjustment Model</a></li>
    <li><a class="dropdown-item" href="../articles/Logis-FE.html">Logistic Fixed Effect Model</a></li>
    <li><a class="dropdown-item" href="../articles/Linear-FE.html">Linear Fixed Effect Model</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/UM-KevinHe/pprof/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Main function for fitting the fixed effect logistic model</h1>
      <small class="dont-index">Source: <a href="https://github.com/UM-KevinHe/pprof/blob/HEAD/R/logis_fe.R" class="external-link"><code>R/logis_fe.R</code></a></small>
      <div class="d-none name"><code>logis_fe.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Fit a fixed effect logistic model via Serial blockwise inversion Newton (SerBIN) or block ascent Newton (BAN) algorithm.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">logis_fe</span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  Y.char <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  Z.char <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ProvID.char <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  Y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  Z <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ProvID <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"SerBIN"</span>,</span>
<span>  max.iter <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  tol <span class="op">=</span> <span class="fl">1e-05</span>,</span>
<span>  bound <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  cutoff <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  backtrack <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  stop <span class="op">=</span> <span class="st">"or"</span>,</span>
<span>  threads <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  message <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  version <span class="op">=</span> <span class="st">"ParaFLR"</span>,</span>
<span>  firth <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>a two-sided formula object describing the model to be fitted,
with the response variable on the left of a ~ operator and covariates on the right,
separated by + operators. The fixed effect of the provider identifier is specified using <code>id()</code>.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>a data frame containing the variables named in the <code>formula</code>,
or the columns specified by <code>Y.char</code>, <code>Z.char</code>, and <code>ProvID.char</code>.</p></dd>


<dt id="arg-y-char">Y.char<a class="anchor" aria-label="anchor" href="#arg-y-char"></a></dt>
<dd><p>a character string specifying the column name of the response variable in the <code>data</code>.</p></dd>


<dt id="arg-z-char">Z.char<a class="anchor" aria-label="anchor" href="#arg-z-char"></a></dt>
<dd><p>a character vector specifying the column names of the covariates in the <code>data</code>.</p></dd>


<dt id="arg-provid-char">ProvID.char<a class="anchor" aria-label="anchor" href="#arg-provid-char"></a></dt>
<dd><p>a character string specifying the column name of the provider identifier in the <code>data</code>.</p></dd>


<dt id="arg-y">Y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p>a numeric vector representing the response variable.</p></dd>


<dt id="arg-z">Z<a class="anchor" aria-label="anchor" href="#arg-z"></a></dt>
<dd><p>a matrix or data frame representing the covariates, which can include both numeric and categorical variables.</p></dd>


<dt id="arg-provid">ProvID<a class="anchor" aria-label="anchor" href="#arg-provid"></a></dt>
<dd><p>a numeric vector representing the provider identifier.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>a string specifying the algorithm to be used. The default value is "SerBIN".</p><ul><li><p><code>"SerBIN"</code> uses the Serial blockwise inversion Newton algorithm to fit the model (See <a href="https://onlinelibrary.wiley.com/doi/full/10.1002/sim.9387" class="external-link">Wu et al. (2022)</a>).</p></li>
<li><p><code>"BAN"</code> uses the block ascent Newton algorithm to fit the model (See <a href="https://link.springer.com/article/10.1007/s10985-013-9264-6" class="external-link">He et al. (2013)</a>).</p></li>
</ul></dd>


<dt id="arg-max-iter">max.iter<a class="anchor" aria-label="anchor" href="#arg-max-iter"></a></dt>
<dd><p>maximum iteration number if the stopping criterion specified by <code>stop</code> is not satisfied. The default value is 10,000.</p></dd>


<dt id="arg-tol">tol<a class="anchor" aria-label="anchor" href="#arg-tol"></a></dt>
<dd><p>tolerance used for stopping the algorithm. See details in <code>stop</code> below. The default value is 1e-5.</p></dd>


<dt id="arg-bound">bound<a class="anchor" aria-label="anchor" href="#arg-bound"></a></dt>
<dd><p>a positive number to avoid inflation of provider effects. The default value is 10.</p></dd>


<dt id="arg-cutoff">cutoff<a class="anchor" aria-label="anchor" href="#arg-cutoff"></a></dt>
<dd><p>An integer specifying the minimum number of observations required for providers.
Providers with fewer observations than the cutoff will be labeled as <code>"include = 0"</code> and excluded from model fitting. The default is 10.</p></dd>


<dt id="arg-backtrack">backtrack<a class="anchor" aria-label="anchor" href="#arg-backtrack"></a></dt>
<dd><p>a Boolean indicating whether backtracking line search is implemented. The default is FALSE.</p></dd>


<dt id="arg-stop">stop<a class="anchor" aria-label="anchor" href="#arg-stop"></a></dt>
<dd><p>a character string specifying the stopping rule to determine convergence.</p><ul><li><p><code>"beta"</code> stop the algorithm when the infinity norm of the difference between current and previous beta coefficients is less than the <code>tol</code>.</p></li>
<li><p><code>"relch"</code> stop the algorithm when the \((loglik(m)-loglik(m-1))/(loglik(m))\) (the difference between the log-likelihood of
the current iteration and the previous iteration divided by the log-likelihood of the current iteration) is less than the <code>tol</code>.</p></li>
<li><p><code>"ratch"</code> stop the algorithm when \((loglik(m)-loglik(m-1))/(loglik(m)-loglik(0))\) (the difference between the log-likelihood of
the current iteration and the previous iteration divided by the difference of the log-likelihood of the current iteration and the initial iteration)
is less than the <code>tol</code>.</p></li>
<li><p><code>"all"</code> stop the algorithm when all the stopping rules (<code>"beta"</code>, <code>"relch"</code>, <code>"ratch"</code>) are met.</p></li>
<li><p><code>"or"</code> stop the algorithm if any one of the rules (<code>"beta"</code>, <code>"relch"</code>, <code>"ratch"</code>) is met.</p></li>
</ul><p>The default value is <code>or</code>. If <code>iter.max</code> is achieved, it overrides any stop rule for algorithm termination.</p></dd>


<dt id="arg-threads">threads<a class="anchor" aria-label="anchor" href="#arg-threads"></a></dt>
<dd><p>a positive integer specifying the number of threads to be used. The default value is 1.</p></dd>


<dt id="arg-message">message<a class="anchor" aria-label="anchor" href="#arg-message"></a></dt>
<dd><p>a Boolean indicating whether to print the progress of the fitting process. The default is TRUE.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list of objects with S3 class <code>"logis_fe"</code>:</p>
<dl><dt>coefficient</dt>
<dd><p>a list containing the estimated coefficients:
<code>beta</code>, the fixed effects for each predictor, and <code>gamma</code>, the effect for each provider.</p></dd>

<dt>variance</dt>
<dd><p>a list containing the variance estimates:
<code>beta</code>, the variance-covariance matrix of the predictor coefficients, and <code>gamma</code>, the variance of the provider effects.</p></dd>

<dt>linear_pred</dt>
<dd><p>the linear predictor of each individual.</p></dd>

<dt>fitted</dt>
<dd><p>the predicted probability of each observation having a response of 1.</p></dd>

<dt>observation</dt>
<dd><p>the original response of each individual.</p></dd>

<dt>Loglkd</dt>
<dd><p>the log-likelihood.</p></dd>

<dt>AIC</dt>
<dd><p>Akaike info criterion.</p></dd>

<dt>BIC</dt>
<dd><p>Bayesian info criterion.</p></dd>

<dt>AUC</dt>
<dd><p>area under the ROC curve.</p></dd>

<dt>char_list</dt>
<dd><p>a list of the character vectors representing the column names for
the response variable, covariates, and provider identifier.
For categorical variables, the names reflect the dummy variables created for each category.</p></dd>

<dt>data_include</dt>
<dd><p>the data used to fit the model, sorted by the provider identifier.
For categorical covariates, this includes the dummy variables created for
all categories except the reference level. Additionally, it contains three extra columns:
<code>included</code>, indicating whether the provider is included based on the <code>cutoff</code> argument;
<code>all.events</code>, indicating if all observations in the provider are 1;
<code>no.events</code>, indicating if all observations in the provider are 0.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function accepts three different input formats:
a formula and dataset, where the formula is of the form <code>response ~ covariates + id(provider)</code>, with <code>provider</code> representing the provider identifier;
a dataset along with the column names of the response, covariates, and provider identifier;
or the binary outcome vector \(\boldsymbol{Y}\), the covariate matrix or data frame \(\mathbf{Z}\), and the provider identifier vector.</p>
<p>The default algorithm is based on Serial blockwise inversion Newton (SerBIN) proposed by
<a href="https://onlinelibrary.wiley.com/doi/full/10.1002/sim.9387" class="external-link">Wu et al. (2022)</a>,
but users can also choose to use the block ascent Newton (BAN) algorithm proposed by
<a href="https://link.springer.com/article/10.1007/s10985-013-9264-6" class="external-link">He et al. (2013)</a> to fit the model.
Both methodologies build upon the Newton-Raphson method, yet SerBIN simultaneously updates both the provider effect and covariate coefficient.
This concurrent update necessitates the inversion of the whole information matrix at each iteration.
In contrast, BAN adopts a two-layer updating approach, where the covariate coefficient is sequentially fixed to update the provider effect,
followed by fixing the provider effect to update the covariate coefficient.</p>
<p>We suggest using the default <code>"SerBIN"</code> option as it typically converges subsequently much faster for most datasets.
However, in rare cases where the SerBIN algorithm encounters second-order derivative irreversibility leading to an error,
users can consider using the <code>"BAN"</code> option as an alternative.
For a deeper understanding, please consult the original article for detailed insights.</p>
<p>If issues arise during model fitting, consider using the <code>data_check</code> function to perform a data quality check,
which can help identify missing values, low variation in covariates, high-pairwise correlation, and multicollinearity.
For datasets with missing values, this function automatically removes observations (rows) with any missing values before fitting the model.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>He K, Kalbfleisch, J, Li, Y, and et al. (2013) Evaluating hospital readmission rates in dialysis providers; adjusting for hospital effects.
<em>Lifetime Data Analysis</em>, <strong>19</strong>: 490-512.
<br></p>
<p>Wu, W, Yang, Y, Kang, J, He, K. (2022) Improving large-scale estimation and inference for profiling health care providers.
<em>Statistics in Medicine</em>, <strong>41(15)</strong>: 2840-2853.
<br></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="data_check.html">data_check</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ExampleDataBinary</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">outcome</span> <span class="op">&lt;-</span> <span class="va">ExampleDataBinary</span><span class="op">$</span><span class="va">Y</span></span></span>
<span class="r-in"><span><span class="va">covar</span> <span class="op">&lt;-</span> <span class="va">ExampleDataBinary</span><span class="op">$</span><span class="va">Z</span></span></span>
<span class="r-in"><span><span class="va">ProvID</span> <span class="op">&lt;-</span> <span class="va">ExampleDataBinary</span><span class="op">$</span><span class="va">ProvID</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">outcome</span>, <span class="va">ProvID</span>, <span class="va">covar</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">covar.char</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">covar</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">outcome.char</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">ProvID.char</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"outcome ~"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">covar.char</span>, collapse <span class="op">=</span> <span class="st">" + "</span><span class="op">)</span>, <span class="st">"+ id(ProvID)"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Fit logistic linear effect model using three input formats</span></span></span>
<span class="r-in"><span><span class="va">fit_fe1</span> <span class="op">&lt;-</span> <span class="fu">logis_fe</span><span class="op">(</span>Y <span class="op">=</span> <span class="va">outcome</span>, Z <span class="op">=</span> <span class="va">covar</span>, ProvID <span class="op">=</span> <span class="va">ProvID</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Input format: Y, Z, and ProvID.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>0 out of 100 providers considered small and filtered out!</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 3 out of 100 remaining providers with no events.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 0 out of 100 remaining providers with all events.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> After screening, 38.77% of all records exhibit occurrences of events (Y = 1)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Setting levels: control = 0, case = 1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Setting direction: controls &lt; cases</span>
<span class="r-in"><span><span class="va">fit_fe2</span> <span class="op">&lt;-</span> <span class="fu">logis_fe</span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, Y.char <span class="op">=</span> <span class="va">outcome.char</span>,</span></span>
<span class="r-in"><span>Z.char <span class="op">=</span> <span class="va">covar.char</span>, ProvID.char <span class="op">=</span> <span class="va">ProvID.char</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Input format: data, Y.char, Z.char, and ProvID.char.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>0 out of 100 providers considered small and filtered out!</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 3 out of 100 remaining providers with no events.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 0 out of 100 remaining providers with all events.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> After screening, 38.77% of all records exhibit occurrences of events (Y = 1)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Setting levels: control = 0, case = 1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Setting direction: controls &lt; cases</span>
<span class="r-in"><span><span class="va">fit_fe3</span> <span class="op">&lt;-</span> <span class="fu">logis_fe</span><span class="op">(</span><span class="va">formula</span>, <span class="va">data</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Input format: formula and data.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>0 out of 100 providers considered small and filtered out!</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 3 out of 100 remaining providers with no events.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 0 out of 100 remaining providers with all events.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> After screening, 38.77% of all records exhibit occurrences of events (Y = 1)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Setting levels: control = 0, case = 1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Setting direction: controls &lt; cases</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Xiaohan Liu, Lingfeng Luo, Yubo Shao, Xiangeng Fang, Wenbo Wu, Kevin He.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

